<%- include('../partials/head') %>
<%- include('../partials/header') %>

<div class="container">
    <h1 class="heading-5">Welcome</h1>
    <a href="https://api.instagram.com/oauth/authorize?client_id=6402427809817520
    &redirect_uri=https://insta-api-basic-c54aed6ebce4.herokuapp.com/&scope=user_profile,user_media&response_type=code"
        class="btn btn-primary" id="insta-login">Login to Insta</a>
</div>

<script>
    const instaLoginButton = document.querySelector('#insta-login')

    const params = new URLSearchParams(window.location.search)
    console.log(params.get('code'))
    if (params.has('code')) {
        const body = new URLSearchParams({
            code: params.get('code')
        })

        fetch('/insta/login', {
            method: 'POST',
            body,
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            }
        })
    }

    // const loginToInsta = () => {
    //     const url = `https://api.instagram.com/oauth/authorize
    // ?client_id=741779321060663
    // &redirect_uri=https://ab8a-182-182-45-151.ngrok-free.app/auth
    // &scope=user_profile,user_media
    // &response_type=code`

    //     fetch(url,{method:'post',headers:{
    //         host: "api.instagram.com",
    //     }})
    // }

    // instaLoginButton.addEventListener('click', loginToInsta)
</script>